---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import { IMAGE_WIDTHS, IMAGE_SIZES } from "../../utils/imageSizes";

interface Props {
  imageUrl?: string | ImageMetadata;
  alt: string;
  size?: 'small' | 'medium' | 'large';
  class?: string;
}

const { 
  imageUrl, 
  alt,
  size = 'medium',
  class: className = ''
} = Astro.props;

const sizes = {
  small: '150px',
  medium: '200px',
  large: '250px'
};

// Map size to standardized widths and sizes
const sizeToWidths: Record<string, readonly number[]> = {
  small: IMAGE_WIDTHS.podcastSmall,
  medium: IMAGE_WIDTHS.podcastMedium,
  large: IMAGE_WIDTHS.podcastLarge,
};

const sizeToSizes: Record<string, string> = {
  small: IMAGE_SIZES.podcastSmall,
  medium: IMAGE_SIZES.podcastMedium,
  large: IMAGE_SIZES.podcastLarge,
};

const widths = sizeToWidths[size] || IMAGE_WIDTHS.podcastMedium;
const sizesAttr = sizeToSizes[size] || IMAGE_SIZES.podcastMedium;
const isImageMetadata = imageUrl && typeof imageUrl === 'object' && 'src' in imageUrl;
---

{
  imageUrl && (
    <div class={`podcast-artwork ${size} ${className}`}>
      {isImageMetadata ? (
        <Image 
          src={imageUrl as ImageMetadata} 
          alt={alt} 
          widths={[...widths]}
          sizes={sizesAttr}
          loading="lazy" 
        />
      ) : (
        // For string URLs (external images), use img tag as Image component requires width/height
        <img src={imageUrl} alt={alt} loading="lazy" decoding="async" />
      )}
    </div>
  )
}

<style define:vars={{ size: sizes[size] }}>
  .podcast-artwork {
    width: var(--size);
    height: var(--size);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }

  .podcast-artwork img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  @media screen and (max-width: 1024px) {
    .podcast-artwork.large {
      width: 200px;
      height: 200px;
    }
    .podcast-artwork.medium {
      width: 150px;
      height: 150px;
    }
    .podcast-artwork.small {
      width: 100px;
      height: 100px;
    }
  }
</style>
