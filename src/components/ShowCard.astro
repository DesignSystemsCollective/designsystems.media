---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import { getShowImage } from "../utils/images";
import FormattedDate from "../components/FormattedDate.astro";
import { getMostRecentEpisodeDateForShow, allPodcastsFilteredAndSorted } from "../utils/mediaCollection";

type Media = CollectionEntry<"show">;
type Props = Media["data"] & { slug?: Media["slug"] };

const { title, image, slug, speakers, episodeCount, lastUpdate } = Astro.props;

const lastUpdateDate = getMostRecentEpisodeDateForShow(slug, allPodcastsFilteredAndSorted);
const posterImage = getShowImage(slug, false);

---

<div class="media-item">
  <a href={`/show/${slug}/`} class="media-link">
    <div class="media-image square shadow">
      {posterImage ? (
        <Image 
          src={posterImage}
          alt={title}
          widths={[240, 540, 900]}
          sizes="(max-width: 640px) 240px, (max-width: 1024px) 540px, 900px"
          loading="lazy"
          decoding="async"
        />
      ) : (
        <img src={image.src} alt={title} loading="lazy" decoding="async" />
      )}
    </div>
    <div class="media-content">
      <h3 class="title">{title}</h3>
      <div class="meta speakers">{speakers.join(", ")}</div>
      <div class="meta">
        <span><FormattedDate date={lastUpdateDate} /></span> 
        <span>â€¢</span> <span>{episodeCount} episodes</span>
      </div>
    </div>
  </a>
</div>

<style>
  /* Style for each media item */
  .media-item {
    margin: 0;
  }
  .media-link {
    text-decoration: none;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    img {
      max-width: 100%;
      height: auto;
      width: 100%;
      aspect-ratio: 1 / 1;
      object-fit: cover;
  }

  .media-link:hover {
    .media-image img {
      box-shadow:
        0 0px 40px var(--accent-glow),
        0 0px 10px var(--accent-hover);
      outline: 1px solid var(--accent-hover);
      transition: box-shadow 1s ease-out;
    }
    .title {
      color: rgb(var(--accent)) ;
    }
  }

  .media-image {
    transition: box-shadow 1s ease-out;
      aspect-ratio: 1 / 1;
        max-height: fit-content;
    border-radius: 6px;
    overflow: hidden;
  }

  .title {
    font-size: 16px;
    font-weight: 400;
    margin: 2px 0;

  overflow: hidden;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 1; /* Limit to 3 lines */
  }
  .meta {
    font-size: 13px;
    color: var(--tx-3);
    display: flex;
    flex-direction: row;
    gap: 8px;
  }
  .speakers {
    font-size: 15px;
  }
  .showTitle {
    font-size: 14px;
    font-weight: 400;
    color: var(--tx-2);
  }

  .media-content {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }
  .date {
    font-size: 13px;
    color: var(--tx-3);
  }

  @media screen and (max-width: 768px) {
    .media-link {
      display: grid;
      grid-template-columns: 1fr 4fr;
    }
    .duration {
      bottom: 0.4rem;
      right: 0.4rem;
      font-size: 0.7rem;
    }
  }
</style>
